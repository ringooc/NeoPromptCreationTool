<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>promptData 編集ツール</title>
    <style>
        body {
            font-family: sans-serif;
            background: #0d1117;
            color: #cdd9e5;
            margin: 0;
            padding: 0;
        }
        
        .container {
            display: flex;
            height: 80vh;
            padding: 1rem;
            gap: 1rem;
        }
        
        #sidebar,
        #subcat {
            width: 20%;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            overflow-y: auto;
            padding: 1rem;
        }
        
        #words {
            width: 40%;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        
        ul {
            list-style: none;
            padding-left: 0;
        }
        
        li {
            padding: 0.3rem 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            user-select: none;
        }
        
        li.selected {
            background-color: #2381ff;
            color: white;
        }
        
        button {
            background: #2381ff;
            border: none;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.2rem 0.2rem 0.2rem 0;
        }
        
        button:disabled {
            background: #555;
            cursor: default;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            box-sizing: border-box;
            border-radius: 5px;
            border: 1px solid #30363d;
            background: #0d1117;
            color: #cdd9e5;
            padding: 0.4rem;
            margin-bottom: 0.6rem;
            font-family: monospace;
            font-size: 14px;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 0.3rem;
            display: block;
        }
        
        #json-output {
            width: 98%;
            height: 140px;
            margin: 1rem auto;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            color: #cdd9e5;
            font-family: monospace;
            padding: 1rem;
            resize: none;
        }
        
        .section-header {
            font-weight: bold;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #30363d;
            padding-bottom: 0.3rem;
        }
    </style>
</head>

<body>

    <h1 style="text-align:center; cursor:pointer;" onclick="location.reload()">プロンプト編集ツール</h1>
    <a href="index.html" style="color: #80c0ff; text-decoration: none;">プロンプト作成ツールにもどる</a>
    <div class="container">
        <div id="sidebar">
            <div class="section-header">大カテゴリー</div>
            <ul id="bigcat-list"></ul>

            <input type="text" id="new-bigcat-input" placeholder="新しい大カテゴリー名" />
            <button id="confirm-add-bigcat">追加</button>
            <button id="delete-bigcat-btn" disabled>削除</button>
            <div id="bigcat-error" style="color:#ff6b6b; font-size:0.85rem;"></div>
        </div>

        <div id="subcat">
            <div class="section-header">小カテゴリー</div>
            <ul id="subcat-list"></ul>

            <input type="text" id="new-subcat-input" placeholder="新しい小カテゴリー名" />
            <button id="confirm-add-subcat" disabled>追加</button>
            <button id="delete-subcat-btn" disabled>削除</button>
            <div id="subcat-error" style="color:#ff6b6b; font-size:0.85rem;"></div>
        </div>

        <div id="words">
            <div class="section-header">ワード一括編集</div>
            <label for="displaynames-textarea">表示名（1行ごと）</label>
            <textarea id="displaynames-textarea" rows="10" placeholder="例：&#10;笑顔&#10;赤面"></textarea>

            <label for="prompts-textarea">プロンプト（行数を揃える）</label>
            <textarea id="prompts-textarea" rows="10" placeholder="例：&#10;smile&#10;blush"></textarea>

            <button id="save-bulk-btn" disabled>保存</button>
            <button id="clear-bulk-btn">クリア</button>
        </div>
    </div>

    <div style="padding:1rem;">
        <div class="section-header">現在のJSON（コピーして保存）</div>
        <textarea id="json-output" readonly></textarea>
    </div>

    <script>
        let promptData = {
            "人物": {
                "性別": {
                    "女の子": "girl",
                    "女性": "woman"
                }
            },
            "表情": {
                "感情": {
                    "笑顔": "smile",
                    "赤面": "blush"
                }
            }
        };

        let selectedBigCat = null;
        let selectedSubCat = null;

        const bigcatList = document.getElementById('bigcat-list');
        const subcatList = document.getElementById('subcat-list');
        const displaynamesTextarea = document.getElementById('displaynames-textarea');
        const promptsTextarea = document.getElementById('prompts-textarea');
        const saveBulkBtn = document.getElementById('save-bulk-btn');
        const clearBulkBtn = document.getElementById('clear-bulk-btn');
        const jsonOutput = document.getElementById('json-output');

        const newBigcatInput = document.getElementById('new-bigcat-input');
        const newSubcatInput = document.getElementById('new-subcat-input');
        const confirmAddBigcatBtn = document.getElementById('confirm-add-bigcat');
        const confirmAddSubcatBtn = document.getElementById('confirm-add-subcat');
        const deleteBigcatBtn = document.getElementById('delete-bigcat-btn');
        const deleteSubcatBtn = document.getElementById('delete-subcat-btn');
        const bigcatError = document.getElementById('bigcat-error');
        const subcatError = document.getElementById('subcat-error');

        function updateJsonOutput() {
            jsonOutput.value = JSON.stringify(promptData, null, 2);
        }

        function renderBigCat() {
            bigcatList.innerHTML = '';
            for (const bigCat of Object.keys(promptData)) {
                const li = document.createElement('li');
                li.textContent = bigCat;
                if (bigCat === selectedBigCat) li.classList.add('selected');
                li.onclick = () => {
                    selectedBigCat = bigCat;
                    selectedSubCat = null;
                    renderBigCat();
                    renderSubCat();
                    clearTextareas();
                    updateButtonStates();
                };
                bigcatList.appendChild(li);
            }
            updateButtonStates();
        }

        function renderSubCat() {
            subcatList.innerHTML = '';
            if (!selectedBigCat) return;
            const subCats = promptData[selectedBigCat];
            for (const subCat of Object.keys(subCats)) {
                const li = document.createElement('li');
                li.textContent = subCat;
                if (subCat === selectedSubCat) li.classList.add('selected');
                li.onclick = () => {
                    selectedSubCat = subCat;
                    renderSubCat();
                    loadWordsToTextareas();
                    updateButtonStates();
                };
                subcatList.appendChild(li);
            }
            updateButtonStates();
        }

        function loadWordsToTextareas() {
            const words = promptData[selectedBigCat][selectedSubCat];
            const labels = Object.keys(words);
            const prompts = Object.values(words);
            displaynamesTextarea.value = labels.join('\n');
            promptsTextarea.value = prompts.join('\n');
            saveBulkBtn.disabled = false;
        }

        function clearTextareas() {
            displaynamesTextarea.value = '';
            promptsTextarea.value = '';
            saveBulkBtn.disabled = true;
        }

        function updateButtonStates() {
            confirmAddSubcatBtn.disabled = !selectedBigCat;
            deleteBigcatBtn.disabled = !selectedBigCat;
            deleteSubcatBtn.disabled = !selectedBigCat || !selectedSubCat;
        }

        confirmAddBigcatBtn.onclick = () => {
            const name = newBigcatInput.value.trim();
            bigcatError.textContent = '';
            if (!name) {
                bigcatError.textContent = '名前を入力してください';
                return;
            }
            if (promptData[name]) {
                bigcatError.textContent = '既に存在します';
                return;
            }
            promptData[name] = {};
            selectedBigCat = name;
            selectedSubCat = null;
            newBigcatInput.value = '';
            renderBigCat();
            renderSubCat();
            clearTextareas();
            updateJsonOutput();
        };

        confirmAddSubcatBtn.onclick = () => {
            const name = newSubcatInput.value.trim();
            subcatError.textContent = '';
            if (!name) {
                subcatError.textContent = '名前を入力してください';
                return;
            }
            if (promptData[selectedBigCat][name]) {
                subcatError.textContent = '既に存在します';
                return;
            }
            promptData[selectedBigCat][name] = {};
            selectedSubCat = name;
            newSubcatInput.value = '';
            renderSubCat();
            clearTextareas();
            updateJsonOutput();
        };

        deleteBigcatBtn.onclick = () => {
            if (selectedBigCat && confirm(`「${selectedBigCat}」を削除してよいですか？`)) {
                delete promptData[selectedBigCat];
                selectedBigCat = null;
                selectedSubCat = null;
                renderBigCat();
                renderSubCat();
                clearTextareas();
                updateJsonOutput();
            }
        };

        deleteSubcatBtn.onclick = () => {
            if (selectedBigCat && selectedSubCat && confirm(`「${selectedSubCat}」を削除してよいですか？`)) {
                delete promptData[selectedBigCat][selectedSubCat];
                selectedSubCat = null;
                renderSubCat();
                clearTextareas();
                updateJsonOutput();
            }
        };

        saveBulkBtn.onclick = () => {
            const labels = displaynamesTextarea.value.trim().split('\n').map(s => s.trim());
            const prompts = promptsTextarea.value.trim().split('\n').map(s => s.trim());
            if (labels.length !== prompts.length) {
                alert('行数が一致しません');
                return;
            }
            const result = {};
            for (let i = 0; i < labels.length; i++) {
                if (labels[i] && prompts[i]) {
                    result[labels[i]] = prompts[i];
                }
            }
            promptData[selectedBigCat][selectedSubCat] = result;
            updateJsonOutput();
            alert('保存しました');
        };

        clearBulkBtn.onclick = clearTextareas;

        renderBigCat();
        renderSubCat();
        updateJsonOutput();
    </script>

</body>

</html>