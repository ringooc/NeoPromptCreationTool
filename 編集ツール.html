<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>promptData 編集ツール</title>
    <style>
        body {
            font-family: sans-serif;
            background: #0d1117;
            color: #cdd9e5;
            margin: 0;
            padding: 1rem
        }
        
        h1 {
            text-align: center;
            cursor: pointer;
            margin-bottom: 1rem
        }
        
        .container {
            display: flex;
            gap: 1rem;
            height: 80vh
        }
        
        #sidebar,
        #subcat {
            width: 20%;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem;
            overflow-y: auto
        }
        
        #words {
            flex: 1;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            overflow-y: auto
        }
        
        .section-header {
            font-weight: bold;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #30363d;
            padding-bottom: 0.3rem
        }
        
        ul {
            list-style: none;
            margin: 0;
            padding: 0
        }
        
        li {
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            cursor: pointer;
            user-select: none
        }
        
        li.selected {
            background: #2381ff;
            color: #fff
        }
        
        input,
        textarea,
        button {
            width: 100%;
            box-sizing: border-box;
            margin: 0.3rem 0;
            padding: 0.5rem;
            background: #0d1117;
            color: #cdd9e5;
            border: 1px solid #30363d;
            border-radius: 4px;
            font-family: monospace
        }
        
        button {
            cursor: pointer;
        }
        
        button:disabled {
            background: #555;
            cursor: default
        }
        
        #json-output {
            height: 200px;
            resize: none
        }
        
        #bigcat-list,
        #subcat-list {
            max-height: 40vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #444 #161b22;
        }
        
        #bigcat-list::-webkit-scrollbar,
        #subcat-list::-webkit-scrollbar {
            width: 6px;
        }
        
        #bigcat-list::-webkit-scrollbar-thumb,
        #subcat-list::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1 onclick="location.reload()">プロンプト編集ツール</h1>
    <a href="index.html" style="color: #80c0ff; text-decoration: none;">プロンプト作成ツールにもどる</a>
    <div class="container">

        <div id="sidebar">
            <div class="section-header">大カテゴリー</div>
            <ul id="bigcat-list"></ul>

            <div class="section-header">追加</div>
            <input id="add-big-input" placeholder="新規大カテゴリー名" />
            <button id="add-big-btn">追加</button>
            <div id="add-big-error" style="color:#ff6b6b;font-size:.85rem"></div>

            <div class="section-header">編集/削除</div>
            <input id="edit-big-input" placeholder="選択後編集用" disabled />
            <button id="rename-big-btn" disabled>変更</button>
            <button id="delete-big-btn" disabled>削除</button>
            <div id="edit-big-error" style="color:#ff6b6b;font-size:.85rem"></div>
        </div>

        <div id="subcat">
            <div class="section-header">小カテゴリー</div>
            <ul id="subcat-list"></ul>

            <div class="section-header">追加</div>
            <input id="add-sub-input" placeholder="新規小カテゴリー名" disabled />
            <button id="add-sub-btn" disabled>追加</button>
            <div id="add-sub-error" style="color:#ff6b6b;font-size:.85rem"></div>

            <div class="section-header">編集/削除</div>
            <input id="edit-sub-input" placeholder="選択後編集用" disabled />
            <button id="rename-sub-btn" disabled>変更</button>
            <button id="delete-sub-btn" disabled>削除</button>
            <div id="edit-sub-error" style="color:#ff6b6b;font-size:.85rem"></div>
        </div>

        <div id="words">
            <div class="section-header">表示名（改行区切り）</div>
            <textarea id="displaynames-text" rows="6"></textarea>
            <div class="section-header">プロンプト（改行数を合わせる）</div>
            <textarea id="prompts-text" rows="6"></textarea>
            <button id="save-words-btn" disabled>追加</button>
            <div class="section-header" style="margin-top:1rem;">現在のJSON</div>
            <textarea id="json-output" readonly></textarea>
            <button id="copy-json-btn" style="width:auto;">コピー</button>
        </div>

    </div>

    <script>
        let promptData = {
            "人物": {
                "性別": {
                    "女の子": "girl",
                    "女性": "woman"
                }
            },
            "表情": {
                "感情": {
                    "笑顔": "smile",
                    "赤面": "blush"
                }
            }
        };
        let selBig = null,
            selSub = null;

        const bigList = document.getElementById("bigcat-list"),
            subList = document.getElementById("subcat-list"),
            addBigInput = document.getElementById("add-big-input"),
            editBigInput = document.getElementById("edit-big-input"),
            addBigBtn = document.getElementById("add-big-btn"),
            renameBigBtn = document.getElementById("rename-big-btn"),
            deleteBigBtn = document.getElementById("delete-big-btn"),
            addBigErr = document.getElementById("add-big-error"),
            editBigErr = document.getElementById("edit-big-error"),

            addSubInput = document.getElementById("add-sub-input"),
            editSubInput = document.getElementById("edit-sub-input"),
            addSubBtn = document.getElementById("add-sub-btn"),
            renameSubBtn = document.getElementById("rename-sub-btn"),
            deleteSubBtn = document.getElementById("delete-sub-btn"),
            addSubErr = document.getElementById("add-sub-error"),
            editSubErr = document.getElementById("edit-sub-error"),

            dispTA = document.getElementById("displaynames-text"),
            promTA = document.getElementById("prompts-text"),
            saveWordsBtn = document.getElementById("save-words-btn"),
            jsonOut = document.getElementById("json-output");

        function updateJSON() {
            jsonOut.value = JSON.stringify(promptData, null, 2)
        }

        function refreshBig() {
            bigList.innerHTML = "";
            Object.keys(promptData).forEach(cat => {
                let li = document.createElement("li");
                li.textContent = cat;
                if (cat === selBig) li.classList.add("selected");
                li.onclick = () => {
                    selBig = cat;
                    selSub = null;
                    addSubInput.disabled = false;
                    editBigInput.value = cat;
                    addBigInput.value = "";
                    editSubInput.value = "";
                    refreshBig();
                    refreshSub();
                    clearWords();
                    updateButtons();
                };
                bigList.append(li);
            });
            updateButtons();
            updateJSON();
        }

        function refreshSub() {
            subList.innerHTML = "";
            if (!selBig) return;
            Object.keys(promptData[selBig]).forEach(sub => {
                let li = document.createElement("li");
                li.textContent = sub;
                if (sub === selSub) li.classList.add("selected");
                li.onclick = () => {
                    selSub = sub;
                    editSubInput.value = sub;
                    addSubInput.value = "";
                    refreshSub();
                    loadWords();
                    updateButtons();
                };
                subList.append(li);
            });
        }

        function clearWords() {
            dispTA.value = "";
            promTA.value = "";
            saveWordsBtn.disabled = true
        }

        function loadWords() {
            let w = promptData[selBig][selSub],
                ks = Object.keys(w),
                vs = Object.values(w);
            dispTA.value = ks.join("\n");
            promTA.value = vs.join("\n");
            saveWordsBtn.disabled = false;
        }

        function updateButtons() {
            addBigBtn.disabled = !addBigInput.value.trim();
            renameBigBtn.disabled = !(selBig && editBigInput.value.trim());
            deleteBigBtn.disabled = !selBig;

            addSubBtn.disabled = !(selBig && addSubInput.value.trim());
            renameSubBtn.disabled = !(selSub && editSubInput.value.trim());
            deleteSubBtn.disabled = !selSub;
            saveWordsBtn.disabled = !(selBig && selSub);
        }

        addBigBtn.onclick = () => {
            let v = addBigInput.value.trim();
            addBigErr.textContent = "";
            if (promptData[v]) {
                addBigErr.textContent = "既に存在";
                return;
            }
            promptData[v] = {};
            selBig = v;
            addBigInput.value = "";
            addSubInput.disabled = false;
            refreshBig();
            refreshSub();
            clearWords();
        };
        renameBigBtn.onclick = () => {
            let v = editBigInput.value.trim();
            editBigErr.textContent = "";
            if (!v || !selBig || promptData[v]) {
                editBigErr.textContent = "無効";
                return;
            }
            promptData[v] = promptData[selBig];
            delete promptData[selBig];
            selBig = v;
            refreshBig();
            refreshSub();
        };
        deleteBigBtn.onclick = () => {
            if (!selBig || !confirm(`「${selBig}」を削除しますか？`)) return;
            delete promptData[selBig];
            selBig = null;
            selSub = null;
            editBigInput.value = "";
            editSubInput.value = "";
            addSubInput.disabled = true;
            refreshBig();
            refreshSub();
            clearWords();
        };

        addSubBtn.onclick = () => {
            let v = addSubInput.value.trim();
            addSubErr.textContent = "";
            if (promptData[selBig][v]) {
                addSubErr.textContent = "既に存在";
                return;
            }
            promptData[selBig][v] = {};
            selSub = v;
            addSubInput.value = "";
            refreshSub();
            clearWords();
        };
        renameSubBtn.onclick = () => {
            let v = editSubInput.value.trim();
            editSubErr.textContent = "";
            if (!v || !selSub || promptData[selBig][v]) {
                editSubErr.textContent = "無効";
                return;
            }
            promptData[selBig][v] = promptData[selBig][selSub];
            delete promptData[selBig][selSub];
            selSub = v;
            refreshSub();
            clearWords();
        };
        deleteSubBtn.onclick = () => {
            if (!selSub || !confirm(`「${selSub}」を削除しますか？`)) return;
            delete promptData[selBig][selSub];
            selSub = null;
            editSubInput.value = "";
            refreshSub();
            clearWords();
        };

        saveWordsBtn.onclick = () => {
            let L = dispTA.value.trim().split("\n"),
                P = promTA.value.trim().split("\n");
            if (L.length !== P.length) {
                alert("行数不一致");
                return;
            }
            let obj = {};
            L.forEach((l, i) => obj[l] = P[i]);
            promptData[selBig][selSub] = obj;
            clearWords();
            updateJSON();
        };

        document.getElementById("copy-json-btn").onclick = () => {
            const text = document.getElementById("json-output").value;
            navigator.clipboard.writeText(text).then(() => {
                //alert("JSONをコピーしました");
            });
        };

        [addBigInput, editBigInput, addSubInput, editSubInput].forEach(e => e.oninput = updateButtons);
        refreshBig();
        refreshSub();
        updateButtons();
        updateJSON();
    </script>
</body>

</html>