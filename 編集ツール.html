<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>promptData 一括編集ツール（表示名・プロンプト別テキストエリア）</title>
    <style>
        body {
            font-family: sans-serif;
            background: #0d1117;
            color: #cdd9e5;
            margin: 0;
            padding: 0;
        }
        
        .container {
            display: flex;
            height: 80vh;
            padding: 1rem;
            gap: 1rem;
        }
        
        #sidebar,
        #subcat {
            width: 20%;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            overflow-y: auto;
            padding: 1rem;
        }
        
        #words {
            width: 40%;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        
        ul {
            list-style: none;
            padding-left: 0;
        }
        
        li {
            padding: 0.3rem 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            user-select: none;
        }
        
        li.selected {
            background-color: #2381ff;
            color: white;
        }
        
        button {
            background: #2381ff;
            border: none;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.3rem 0.3rem 0 0;
        }
        
        button:disabled {
            background: #555;
            cursor: default;
        }
        
        input[type="text"],
        textarea {
            width: 100%;
            box-sizing: border-box;
            border-radius: 5px;
            border: 1px solid #30363d;
            background: #0d1117;
            color: #cdd9e5;
            padding: 0.4rem;
            margin-bottom: 0.8rem;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 0.3rem;
            display: block;
        }
        
        #json-output {
            width: 98%;
            height: 120px;
            margin: 1rem auto;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            color: #cdd9e5;
            font-family: monospace;
            padding: 1rem;
            resize: none;
        }
        
        .section-header {
            font-weight: bold;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #30363d;
            padding-bottom: 0.3rem;
        }
        
        #textareas-container {
            display: flex;
            gap: 1rem;
        }
        
        #display-names,
        #prompts {
            width: 50%;
        }
    </style>
</head>

<body>

    <h1 style="text-align:center; cursor:pointer; user-select:none;" onclick="location.reload()">プロンプト作成ツール（表示名・プロンプト別）</h1>
    <a href="index.html" style="color: #80c0ff; text-decoration: none;">プロンプト作成ツールにもどる</a>
    <div class="container">
        <div id="sidebar">
            <div class="section-header">大カテゴリー</div>
            <ul id="bigcat-list"></ul>
            <button id="add-bigcat-btn">＋ 大カテゴリー追加</button>
        </div>

        <div id="subcat">
            <div class="section-header">小カテゴリー</div>
            <ul id="subcat-list"></ul>
            <button id="add-subcat-btn" disabled>＋ 小カテゴリー追加</button>
        </div>

        <div id="words">
            <div class="section-header">ワード一括編集</div>
            <div id="textareas-container">
                <div id="display-names">
                    <label for="displaynames-textarea">表示名（1行に1つ）</label>
                    <textarea id="displaynames-textarea" placeholder="例&#10;笑顔&#10;赤面" rows="10"></textarea>
                </div>
                <div id="prompts">
                    <label for="prompts-textarea">プロンプト（対応する表示名と同じ行数で）</label>
                    <textarea id="prompts-textarea" placeholder="例&#10;smile&#10;blush" rows="10"></textarea>
                </div>
            </div>
            <button id="save-bulk-btn" disabled>保存</button>
            <button id="clear-bulk-btn">クリア</button>
        </div>
    </div>

    <div style="padding:1rem;">
        <div class="section-header">現在のJSON（コピーして保存してください）</div>
        <textarea id="json-output" readonly></textarea>
    </div>

    <script>
        // 初期データ例
        let promptData = {
            "人物": {
                "性別": {
                    "女の子": "girl",
                    "女性": "woman"
                },
                "年齢": {
                    "幼女": "little girl",
                    "大人": "adult woman"
                }
            },
            "表情": {
                "ポジティブ": {
                    "笑顔": "smile",
                    "にこにこ": "grin"
                },
                "ネガティブ": {
                    "怒り": "angry",
                    "悲しみ": "sad"
                }
            }
        };

        let selectedBigCat = null;
        let selectedSubCat = null;

        const bigcatList = document.getElementById('bigcat-list');
        const subcatList = document.getElementById('subcat-list');
        const displaynamesTextarea = document.getElementById('displaynames-textarea');
        const promptsTextarea = document.getElementById('prompts-textarea');
        const saveBulkBtn = document.getElementById('save-bulk-btn');
        const clearBulkBtn = document.getElementById('clear-bulk-btn');
        const addBigcatBtn = document.getElementById('add-bigcat-btn');
        const addSubcatBtn = document.getElementById('add-subcat-btn');
        const jsonOutput = document.getElementById('json-output');

        function updateJsonOutput() {
            jsonOutput.value = JSON.stringify(promptData, null, 2);
        }

        function renderBigCat() {
            bigcatList.innerHTML = '';
            for (const bigCat of Object.keys(promptData)) {
                const li = document.createElement('li');
                li.textContent = bigCat;
                if (bigCat === selectedBigCat) li.classList.add('selected');
                li.onclick = () => {
                    selectedBigCat = bigCat;
                    selectedSubCat = null;
                    displaynamesTextarea.value = '';
                    promptsTextarea.value = '';
                    saveBulkBtn.disabled = true;
                    renderBigCat();
                    renderSubCat();
                };
                bigcatList.appendChild(li);
            }
        }

        function renderSubCat() {
            subcatList.innerHTML = '';
            if (!selectedBigCat) {
                addSubcatBtn.disabled = true;
                return;
            }
            addSubcatBtn.disabled = false;
            const subCats = promptData[selectedBigCat];
            for (const subCat of Object.keys(subCats)) {
                const li = document.createElement('li');
                li.textContent = subCat;
                if (subCat === selectedSubCat) li.classList.add('selected');
                li.onclick = () => {
                    selectedSubCat = subCat;
                    saveBulkBtn.disabled = false;
                    renderSubCat();
                    loadWordsToTextareas();
                };
                subcatList.appendChild(li);
            }
        }

        function loadWordsToTextareas() {
            if (!selectedBigCat || !selectedSubCat) {
                displaynamesTextarea.value = '';
                promptsTextarea.value = '';
                saveBulkBtn.disabled = true;
                return;
            }
            const words = promptData[selectedBigCat][selectedSubCat];
            const labels = [];
            const prompts = [];
            for (const [label, prompt] of Object.entries(words)) {
                labels.push(label);
                prompts.push(prompt);
            }
            displaynamesTextarea.value = labels.join('\n');
            promptsTextarea.value = prompts.join('\n');
            saveBulkBtn.disabled = false;
        }

        saveBulkBtn.onclick = () => {
            if (!selectedBigCat || !selectedSubCat) {
                alert('大カテゴリーと小カテゴリーを選択してください。');
                return;
            }
            const labels = displaynamesTextarea.value.trim().split('\n').map(s => s.trim());
            const prompts = promptsTextarea.value.trim().split('\n').map(s => s.trim());
            if (labels.length !== prompts.length) {
                alert('表示名とプロンプトの行数が一致しません。');
                return;
            }
            let newWords = {};
            for (let i = 0; i < labels.length; i++) {
                const label = labels[i];
                const prompt = prompts[i];
                if (!label || !prompt) {
                    alert(`行 ${i + 1} に空の表示名かプロンプトがあります。`);
                    return;
                }
                newWords[label] = prompt;
            }
            promptData[selectedBigCat][selectedSubCat] = newWords;
            updateJsonOutput();
            alert('保存しました');
        };

        clearBulkBtn.onclick = () => {
            displaynamesTextarea.value = '';
            promptsTextarea.value = '';
            saveBulkBtn.disabled = true;
        };

        addBigcatBtn.onclick = () => {
            const newCat = prompt('追加する大カテゴリー名を入力してください');
            if (!newCat) return;
            if (promptData[newCat]) {
                alert('すでに存在するカテゴリー名です');
                return;
            }
            promptData[newCat] = {};
            selectedBigCat = newCat;
            selectedSubCat = null;
            renderBigCat();
            renderSubCat();
            displaynamesTextarea.value = '';
            promptsTextarea.value = '';
            saveBulkBtn.disabled = true;
            updateJsonOutput();
        };

        addSubcatBtn.onclick = () => {
            if (!selectedBigCat) return;
            const newSub = prompt('追加する小カテゴリー名を入力してください');
            if (!newSub) return;
            if (promptData[selectedBigCat][newSub]) {
                alert('すでに存在する小カテゴリー名です');
                return;
            }
            promptData[selectedBigCat][newSub] = {};
            selectedSubCat = newSub;
            renderSubCat();
            displaynamesTextarea.value = '';
            promptsTextarea.value = '';
            saveBulkBtn.disabled = true;
            updateJsonOutput();
        };

        // 初期描画
        renderBigCat();
        renderSubCat();
        updateJsonOutput();
    </script>

</body>

</html>